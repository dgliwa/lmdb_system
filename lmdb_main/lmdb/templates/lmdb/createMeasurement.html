{% extends "base.html" %}
{% block pageName %}Create Measurement{% endblock %}
{% block customjs %}
   {% load static %}
    <link rel="stylesheet" href="//js.arcgis.com/3.6/js/dojo/dijit/themes/claro/claro.css">
    <link rel="stylesheet" href="//js.arcgis.com/3.6/js/esri/css/esri.css">
    <script type="text/javascript" src="{% static "datepicker/jquery.simple-dtpicker.js" %}"></script>
	<link type="text/css" href="{% static "datepicker/jquery.simple-dtpicker.css" %}" rel="stylesheet" />

    <style>
      html, body {
        height: 100%;
        width: 100%;
        margin: 0; 
        padding: 0;
      }
      #header {
        border:solid 2px #462d44;
        background:#fff;
        color:#444;
        -moz-border-radius: 4px;
        border-radius: 4px;
        font-family: sans-serif;
        font-size: 1.1em
        padding-left:20px;
      }
      #map {
        padding:1px;
        border:solid 2px #444;
        -moz-border-radius: 4px;
        border-radius: 4px;
      }
      #rightPane {
        border:none;
        padding: 0;
        width:228px;
      }
      .templatePicker {
        border: solid 2px #444;
      }
    </style>
    
    

 <script src="//ajax.googleapis.com/ajax/libs/jquery/1.7/jquery.js"></script> 
    <script src="//malsup.github.com/jquery.form.js"></script> 

    <script src="//js.arcgis.com/3.6/"></script>
    
        <script> 
        // wait for the DOM to be loaded    
       
        $(document).ready(function() { 
            // bind 'latlonform' and provide a simple callback function 
            $('#latlonform').ajaxForm(function() { 
            }); 
            
            $("#createMeasurement").click(function() {
           $("#measurementForm").submit();
       });
    
       $("#paramSubmit").submit(function(e){
            e.preventDefault();
            var values = $(this).serialize();
            
            var a = $.post('/reference/parameters/createFromData/', values, function(response) {
    // log the response to the console
    console.log("Response: "+response);
    console.log(response['commonname']);
 $("#id_parameterid").append('<option value="' + response['id'] + '">' + response['commonname'] + '</option>');
      $("#id_parameterid option:last").attr('selected', 'selected');
       },'json');
    console.log(a);
    this.reset();
        $("#paramSubmit").css('visibility','hidden')

    });
        }); 
        
        
    </script> 
    
    
<script>


function addParameter(){
    $("#paramSubmit").css('visibility','visible')

};




</script>

{% include 'mapbase.html' %}

{% endblock %}
{% block customclass %}
class ="claro"
{% endblock %}
{% block content %}
<table>
<tbody>
<tr>
<td style="width:75%">
<form id="measurementForm" action="{% url 'lmdb:createMeasurement' %}" method="post">
{% csrf_token %}
{{form.non_field_errors}}
{{form.objectid.errors}}
{{form.objectid}}
{{form.mname.errors}}
Name:  {{form.mname}}<br>
{{form.parameterid.errors}}
Parameter:  {{form.parameterid}}  <button type="button" onclick="addParameter();">Add Parameter</button>

<br>
{{form.projectid.errors}}
Project:  {{form.projectid}} <br>
{{form.medium.errors}}
Medium:  {{form.medium}} <br>
{{form.mmethod.errors}}
Measurement Method:  {{form.mmethod}} <br>
{{form.mquant.errors}}
Measurement Quantity: {{form.mquant}} <br>
{{form.munits.errors}}
Measurement Units:  {{form.munits}} <br>
{{form.date.errors}}
Measurement Date:  {{form.date}} <br>
<script type="text/javascript">
		$.noConflict();
		jQuery($(function(){
			$('#id_date').appendDtpicker();
		}));
	</script>
{{form.notes.errors}}
Measurement Notes:  {{form.notes}} <br>
{{form.personid.errors}}
Person:  {{form.personid}}<br>

{{form.locationid.errors}}
Location:  {{form.locationid}} <br>

</form>
</td>
<td>
<form id = "paramSubmit" style = "visibility:hidden;" id="paramForm" name="paramForm" >
{% csrf_token %}
<p>If you do not know the CAS or EPA Number(s), you can search for them <a href="http://ofmpub.epa.gov/sor_internet/registry/substreg/searchandretrieve/substancesearch/search.do" target="_blank">here</a></p>

Scientific Name:
<input id="sciname" type = "text" name="sciname"/>
Common Name:
<input id="comname" type = "text" name ="commonname"/>
CAS Number:
<input id="casnum" type = "text" name ="casnumber"/>
EPA Number:
<input id="epanum" type = "text" name="epanumber"/>

<input type="submit" value="Submit"/>
</form>
</td>
</tr>
</tbody>
</table>
<div data-dojo-type="dijit/layout/BorderContainer" data-dojo-props="gutters:true, design:'headline'" style="width:100%;height:100%;">
      <div data-dojo-type="dijit/layout/ContentPane"  id="header" data-dojo-props="region:'top'">
            To add a location, click on the desired type of location (point, line, polygon) and then click where it is located on the map.
      A popup will appear stating that it has been successfully added.

           </div>
      <div id="map" data-dojo-type="dijit/layout/ContentPane" data-dojo-props="region:'center'"></div>
      <div id="rightPane" data-dojo-type="dijit/layout/ContentPane" data-dojo-props="region:'right'">
        <div id="templatePickerDiv"></div>

          </div>
          </div>

<input id="createMeasurement" type="submit" value="Create Measurement" />


{% endblock %}



