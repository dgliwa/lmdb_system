<!DOCTYPE html>
<html>
<head>
 <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7/jquery.js"></script> 
 {% load staticfiles %}
<link rel="stylesheet" href="{% static "bootstrap/css/bootstrap.css" %}"/>
<script>
$(function(){
    $("select#id_kingdom").change(function(){
      $.getJSON("/reference/organisms/kingdomFilter/"+$(this).val()+"/", function(j) {
        var options = '<option value="">---------- </option>';
        for (var i = 0; i < j.length; i++) {
          options += '<option value="' + j[i].phylum + '">' + j[i].phylum + '</option>';
        }
        $("#id_phylum").html(options);
        $("#id_phylum option:first").attr('selected', 'selected');
        $("#id_phylum").attr('disabled', false);
      })
      $("#id_kingdom").attr('selected', 'selected');
    })
  })
  
  
$(function(){
    $("select#id_phylum").change(function(){
      $.getJSON("/reference/organisms/phylumFilter/"+$(this).val()+"/", function(j) {
        var options = '<option value="">---------- </option>';
        for (var i = 0; i < j.length; i++) {
          options += '<option value="' + j[i].class_field + '">' + j[i].class_field + '</option>';
        }
        $("#id_class_field").html(options);
        $("#id_class_field option:first").attr('selected', 'selected');
        $("#id_class_field").attr('disabled', false);
      })
      $("#id_phylum").attr('selected', 'selected');
    })
  })
  
//   $(function(){
//     $("select#id_kingdom").change(function(){
//       $.getJSON("/reference/organisms/kingdomFilter/"+$(this).val()+"/", function(j) {
//         var options = '<option value="">---------- </option>';
//         for (var i = 0; i < j.length; i++) {
//           options += '<option value="' + parseInt(j[i].pk) + '">' + j[i].fields['longname'] + '</option>';
//         }
//         $("#id_phylum").html(options);
//         $("#id_phylum option:first").attr('selected', 'selected');
//         $("#id_phylum").attr('disabled', false);
//       })
//       $("#id_kingdom").attr('selected', 'selected');
//     })
//   })

function manClassUpdate(phyl){
jQuery.getJSON("/reference/organisms/phylumFilter/"+phyl+"/", function(j) {
        var options = '<option value="">---------- </option>';
        for (var i = 0; i < j.length; i++) {
          options += '<option value="' + j[i].class_field + '">' + j[i].class_field + '</option>';
        }
        $("#id_class_field").html(options);
        $("#id_class_field option:first").attr('selected', 'selected');
        $("#id_class_field").attr('disabled', false);
      })
      $("#id_phylum").attr('selected', 'selected');

};

function addPhylum(){
try{

    var phylum = document.forms["phylumForm"]["newPhylum"].value;
    var select = document.getElementById('id_phylum');
    var option = document.createElement("option");
    option.text = phylum;
    option.value = phylum;
    select.appendChild(option);

    $('#id_phylum option:last-child').attr('selected', 'selected'); 
    manClassUpdate(phylum);

    }
    catch(err){
    console.log(err);
    }
    return false;   

};
</script>


</head>
<form action="{% url 'reference:createOrganism' %}" method="post">
<img src="{% static "bootstrap/img/glyphicons-halflings-white.png" %}" alt="My image"/>
<table>
<tr>
<td style='vertical-align:text-top;'>
{% csrf_token %}
{{form.non_field_errors}}
{{form.objectid.errors}}
{{form.objectid}}
{{form.organismname.errors}}
Organism Name:  {{form.organismname}}<br>
{{form.kingdom.errors}}
Organism Kingdom:  {{form.kingdom}}<br>
{{form.phylum.errors}}
Organism Phylum: {{form.phylum}} <br>
{{form.class_field.errors}} 
Organism Class:  {{form.class_field}}<br>
{{form.order_field.errors}}
Organism Order:  {{form.order_field}}<br>
{{form.family.errors}}
Organism Family:  {{form.family}}<br>
{{form.genus.errors}}
Organism Genus:  {{form.genus}}<br>
{{form.species.errors}}
Organism Species:  {{form.species}}<br>
<input type="submit" value="Create Organism" />
</form>
</td>
<td style='vertical-align:text-top'>
<form id="phylumForm" name="phylumForm" onSubmit="return addPhylum()">
<br>
<br>
                                <input type="text" name="newPhylum"/> <input type="submit" name="submit" value="Add Phylum"/>
                                </form>
</td>
<tr>



</html>